<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MUX Builder</title>
    <link rel="stylesheet" href="../stylesheet.css"/>
    <link rel="stylesheet" href="./style.css"/>

    <script type="text/javascript" src="./script.js"></script>
</head>

<!-- Out of the body. Designed to be cloned. -->
<!-- Some un-implemented CSS classes are here to be used by a querySelector -->

<!-- TODO Add the REST Consumer, when ready -->

<div id="serial-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Port Name</td>
            <td><input type="text" class="port-name" size="30" placeholder="Serial Port Name"></td>
        </tr>
        <tr>
            <td>Baud Rate</td>
            <td><input type="number" class="baud-rate" placeholder="Baud Rate"></td>
        </tr>
        <tr>
            <td>Device Filters</td>
            <td><input type="text" class="device-filter" placeholder="Device Filters" size="30" title="Comma separated list"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
        <tr>
            <td>Reset Interval</td>
            <td><input type="number" class="reset-interval" placeholder="Reset Interval" value="60000"></td>
        </tr>
        <!--
        device.filters: GP, GN, GL
        sentence.filters: ~GSV, ~GSA, ~GGA
        -->
    </table>
</div>

<div id="tcp-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Server name or IP</td>
            <td><input type="text" class="server-name" size="30" placeholder="Server Name"></td>
        </tr>
        <tr>
            <td>Port</td>
            <td><input type="number" class="port-num" placeholder="TCP Port"></td>
        </tr>
        <tr>
            <td>Device Filters</td>
            <td><input type="text" class="device-filter" placeholder="Device Filters" size="30" title="Comma separated list"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
    </table>
</div>

<div id="file-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>File Name</td>
            <td><input type="text" class="file-name" size="30" placeholder="Log File Name"></td>
        </tr>
        <tr>
            <td>Zip</td>
            <td><input type="checkbox" class="zip-option"></td>
        </tr>
        <tr>
            <td>Path in Zip</td>
            <td><input type="text" class="zip-path" size="30" placeholder="Path in Zip"></td>
        </tr>
        <tr>
            <td>Device Filters</td>
            <td><input type="text" class="device-filter" placeholder="Device Filters" size="30" title="Comma separated list"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
        <tr>
            <td>Between records</td>
            <td><input type="number" class="between-records" placeholder="1000"></td>
        </tr>
        <tr>
            <td>Loop</td>
            <td><input type="checkbox" class="loop"></td>
        </tr>
        <!--
        device.filters: GP, GN, GL
        sentence.filters: ~GSV, ~GSA, ~GGA
        between-records: 1000
        loop: true
        -->
    </table>
</div>

<div id="device-prefix-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Device Prefix</td>
            <td><input type="text" class="device-prefix" placeholder="Device Prefix" size="30" title="Device Prefix, 2 characters"></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
    </table>
</div>

<div id="lsm303-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Device Prefix</td>
            <td><input type="text" class="device-prefix" placeholder="Device Prefix" size="30" title="Device Prefix, 2 characters"></td>
        </tr>
        <tr>
            <td>Heading Offset</td>
            <td><input type="number" class="heading-offset" step="1" placeholder="Heading Offset"></td>
        </tr>
        <tr>
            <td>Damping size</td>
            <td><input type="number" class="damping-size" step="1" placeholder="Damping Size" value="5"></td>
        </tr>
        <tr>
            <td>Read Frequency</td>
            <td><input type="number" class="read-frequency" step="1" placeholder="Read Frequency in ms" value="1000"></td>
        </tr>
        <tr>
            <td>Feature</td>
            <td>
                <select class="lsm-303-feature">
                    <option value="BOTH">Both</option>
                    <option value="MAGNETOMETER">Magnetometer</option>
                    <option value="ACCELEROMETER">Accelerometer</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>Calibration properties file</td>
            <td><input type="text" class="calibration-properties" placeholder="Calibration properties file" size="30"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
    </table>
</div>

<div id="hcm5883l-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Device Prefix</td>
            <td><input type="text" class="device-prefix" placeholder="Device Prefix" size="30" title="Device Prefix, 2 characters"></td>
        </tr>
        <tr>
            <td>Heading Offset</td>
            <td><input type="number" class="heading-offset" step="1" placeholder="Heading Offset"></td>
        </tr>
        <tr>
            <td>Damping size</td>
            <td><input type="number" class="damping-size" step="1" placeholder="Damping Size" value="5"></td>
        </tr>
        <tr>
            <td>Read Frequency</td>
            <td><input type="number" class="read-frequency" step="1" placeholder="Read Frequency in ms" value="1000"></td>
        </tr>
        <tr>
            <td>Calibration properties file</td>
            <td><input type="text" class="calibration-properties" placeholder="Calibration properties file" size="30"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
    </table>
</div>

<div id="ws-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>WS URL</td>
            <td><input type="text" class="ws-url" size="30" placeholder="ws://machine-address:port/path"></td>
        </tr>
        <tr>
            <td>Device Filters</td>
            <td><input type="text" class="device-filter" placeholder="Device Filters" size="30" title="Comma separated list"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
    </table>
</div>

<div id="no-prm-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
    </table>
</div>

<div id="generic-channel-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <th colspan="2"><b><i>Generic</i></b></th>
        </tr>
        <tr>
            <td>Device Filters</td>
            <td><input type="text" class="device-filter" placeholder="Device Filters" size="30" title="Comma separated list"></td>
        </tr>
        <tr>
            <td>Sentence Filters</td>
            <td><input type="text" class="sentence-filter" placeholder="Sentence Filters" size="30" title="Like RMC, GLL,&#13;~GSV, ~GGA to negate the filter."></td>
        </tr>
        <tr>
            <td>Verbose</td>
            <td><input type="checkbox" class="verbose"></td>
        </tr>
        <tr>
            <td>Read Frequency</td>
            <td><input type="number" class="frequency" placeholder="Sentence Filters" value="1000"></td>
        </tr>
    </table>
</div>

<div id="generic-forwarder-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <th colspan="2"><b><i>Generic</i></b></th>
        </tr>
    </table>
</div>

<div id="serial-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Port Name</td>
            <td><input type="text" class="port-name" size="30" placeholder="Serial Port Name"></td>
        </tr>
        <tr>
            <td>Baud Rate</td>
            <td><input type="number" class="baud-rate" placeholder="Baud Rate"></td>
        </tr>
    </table>
</div>

<div id="tcp-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Port</td>
            <td><input type="number" class="port-num" placeholder="TCP Port"></td>
        </tr>
    </table>
</div>

<div id="gpsd-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Port</td>
            <td><input type="number" class="port-num" placeholder="GPSD Port" value="2947"></td>
        </tr>
    </table>
</div>

<div id="ws-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>WebSocket URI</td>
            <td><input type="text" class="ws-uri" placeholder="WS uri"></td>
        </tr>
    </table>
</div>

<div id="rmi-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>RMI port</td>
            <td><input type="number" class="port-num" placeholder="RMI Port" value="1099"></td>
        </tr>
        <tr>
            <td>RMI name</td>
            <td><input type="text" class="rmi-name" placeholder="RMI Name" value="RMI-NMEA"></td>
        </tr>
    </table>
</div>

<div id="console-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>No parameter</td>
        </tr>
    </table>
</div>

<script type="text/javascript">
// Utilities for the file-forwarder
function fileFwdOption(sel) {
    console.log(`Value changed to ${sel.value}`);
    let optionId = null;
    if (sel.value === 'one-file') {
       optionId = 'file-fwd-option-one';
    } else if (sel.value === 'time-based') {
       optionId = 'file-fwd-option-two';
    }
    let specificFileOption = document.getElementById(optionId);
    let newOptionElement = specificFileOption.cloneNode(true);
    newOptionElement.style.display = 'block';
    // Find parameter's table
    let parentTable = sel;
    while (!(parentTable instanceof HTMLTableElement)) {
      parentTable = parentTable.parentElement;
    }
    let optionLocation = parentTable.querySelector('.file-fwd-prms');
     while (optionLocation.firstChild) { // Remove what's in there
        optionLocation.removeChild(optionLocation.firstChild)
     }
     optionLocation.appendChild(newOptionElement);
}
</script>

<div id="file-fwd-option-one" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>File Name</td>
            <td><input type="text" class="logfile-name" size="30" placeholder="Log File Name"></td>
        </tr>
        <tr>
            <td>Append</td>
            <td><input type="checkbox" class="append"></td>
        </tr>
    </table>
</div>

<div id="file-fwd-option-two" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Log files suffix</td>
            <td><input type="text" class="logfile-suffix" size="30" placeholder="Log File Suffix"></td>
        </tr>
        <tr>
            <td>Log files directory</td>
            <td><input type="text" class="logfile-dir" size="30" placeholder="Log File Folder"></td>
        </tr>
        <tr>
            <td>Log files Split</td>
            <td>
                <select class="log-file-split">
                    <option value="min">Minute</option>
                    <option value="hour">Hour</option>
                    <option value="day">Day</option>
                    <option value="week">Week</option>
                    <option value="month">Month</option>
                    <option value="year">Year</option>
                </select>
            </td>
        </tr>
    </table>
</div>

<div id="file-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Option</td>
            <td>
                <select onchange="fileFwdOption(this);" class="file-fwd-option">
                    <option value="one-file">One log file</option>
                    <option value="time-based">Time based file names</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="file-fwd-prms" colspan="2">
                    Placeholder
            </td>
        </tr>
        <tr>
            <td>Flush</td>
            <td><input type="checkbox" class="flush"></td>
        </tr>
    </table>
</div>

<div id="rest-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Server</td>
            <td><input type="text" class="server-name" size="30" placeholder="Server Name or IP"></td>
        </tr>
        <tr>
            <td>Port</td>
            <td><input type="number" class="server-port" placeholder="Server Port" value="8080"></td>
        </tr>
        <tr>
            <td>Resource</td>
            <td><input type="text" class="server-resource" size="30" placeholder="/mux/nmea-sentence"></td>
        </tr>
        <tr>
            <td>Verb</td>
            <td>
                <select class="rest-verb">
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="PATCH">PATCH</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>Protocol</td>
            <td>
                <select class="rest-protocol">
                    <option value="http">http</option>
                    <option value="https">https</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>Header(s)</td>
            <td><input type="text" class="rest-headers" size="30" placeholder="REST Headers" value="Content-Type:plain/text"></td>
        </tr>
    </table>
</div>

<div id="dyn-fwd-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Class Name</td>
            <td><input type="text" class="class-name" size="30" placeholder="Class Name"></td>
        </tr>
        <tr>
            <td>Properties File</td>
            <td><input type="text" class="propfile-name" size="30" placeholder="Properties file Name"></td>
        </tr>
    </table>
</div>



<div id="tw-current-computer-parameters" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Prefix</td>
            <td><input type="text" class="device-prefix" placeholder="Device Prefix" value="CC"></td>
        </tr>
        <tr>
            <td>Time Buffer Length</td>
            <td><input type="text" class="time-buffer-length" placeholder="Comma separated, in milliseconds" value="30, 60, 600"></td>
        </tr>
    </table>
</div>

<div id="add-channel" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Channel:</td>
            <td>
                <select onchange="setChannelParameters(this.value, this);">
                    <option value="serial">Serial</option>
                    <option value="tcp">TCP</option>
                    <option value="file">File</option>
                    <option value="ws">WebSocket</option>
                    <option value="htu21df">HTU21DF</option>
                    <option value="bme280">BME280</option>
                    <option value="bmp180">BMP180</option>
                    <option value="hmc5883l">HCM5883L</option>
                    <option value="lsm303">LSM303</option>
                    <option value="zda">ZDA</option>
                    <option value="rnd">RND</option>
                </select>
                <div class="channel-descr" style="max-height: 100px; overflow-y: scroll;"></div>
            </td>
            <td>
                Specific parameters placeholder
            </td>
            <td>
                <button onclick="removeChannel(this);" style="margin: 3px;">Remove</button>
            </td>
        </tr>
    </table>
</div>

<div id="add-forwarder" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Forwarder:</td>
            <td>
                <select onchange="setForwarderParameters(this.value, this);">
                    <option value="serial">Serial</option>
                    <option value="tcp">TCP</option>
                    <!--option value="udp">UDP</option-->
                    <option value="file">File</option>
                    <option value="ws">WebSocket</option>
                    <!--option value="mqtt">MQTT</option--> <!-- Use dynamic loading -->
                    <option value="rest">REST</option>
                    <option value="gpsd">GPSD</option>
                    <option value="wsp">WebSocket Processor</option>
                    <option value="console">Console</option>
                    <option value="rmi">RMI</option>
                    <option value="dyn">Dynamic Class</option>
                </select>
                <div class="forwarder-descr" style="max-height: 100px; overflow-y: scroll;"></div>
            </td>
            <td>
                Specific parameters placeholder
            </td>
            <td>
                <button onclick="removeForwarder(this);" style="margin: 3px;">Remove</button>
            </td>
        </tr>
    </table>
</div>

<div id="add-computer" style="display: none; border-radius: 5px; border: 1px solid silver; margin: 3px;">
    <table>
        <tr>
            <td>Computer:</td>
            <td>
                <select onchange="setComputerParameters(this.value, this);">
                    <option value="tw-current">Current with True Wind</option>
                </select>
                <div class="computer-descr" style="max-height: 100px; overflow-y: scroll;"></div>
            </td>
            <td>
                Specific parameters placeholder
            </td>
            <td>
                <button onclick="removeComputer(this);" style="margin: 3px;">Remove</button>
            </td>
        </tr>
    </table>
</div>

<!--

      Page Body starts here

 +-->
<body>

<dialog id="generated-code-dialog">
    <div class="dialog-header">
        <span>Generated yaml, to copy-paste</span>
        <span class="dialog-header-close" onclick="closeGeneratedDialog();">&times</span>
    </div>
    <div style="text-align: left; max-height: 300px; overflow-y: scroll;">
        <pre><span id="generated-yaml"></span></pre> <!-- This contains the final result -->
    </div>
</dialog>    

<h2>Build a yaml properties file from a Web UI</h2>
<div>
    <label for="mux-title">MUX definition</label>
    <input type="text" id="mux-title" placeholder="MUX Title" style="width: 200px;">
</div>
<div>
    <h4>Context</h4>
    <div>
        <label for="with-http">With HTTP/REST Server</label>
        <input type="checkbox" id="with-http" onchange="expandCollapseHTTP(this);">
        <div id="http-specific" class="smooth">
            <table>
                <tr>
                    <td>
                        <label for="http-port">HTTP Port</label>
                    </td>
                    <td>
                        <input type="number" min="80" step="1" placeholder="HTTP Port number" id="http-port" value="8080">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="init-cache">Init Cache</label>
                    </td>
                    <td>
                        <input type="checkbox" id="init-cache" checked>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <table>
                <tr>
                    <td>Default Declination</td>
                    <td><input type="number" class="declination" step="0.1" value="14.0" id="default-decl"></td>
                </tr>
                <tr>
                    <td>Deviation file name</td>
                    <td><input type="text" id="dev-file-name" placeholder="Declination csv file name"></td>
                </tr>
                <tr>
                    <td>Max Leeway Angle</td>
                    <td><input type="number" min="0" step="0.1" value="10.0" id="max-leeway"></td>
                </tr>
                <tr>
                    <td>BSP Factor</td>
                    <td><input type="number" min="0" step="0.1" value="1.0" id="bsp-factor"></td>
                </tr>
                <tr>
                    <td>AWS Factor</td>
                    <td><input type="number" min="0" step="0.1" value="1.0" id="aws-factor"></td>
                </tr>
                <tr>
                    <td>AWA Offset</td>
                    <td><input type="number" step="0.1" value="0.0" id="awa-offset"></td>
                </tr>
                <tr>
                    <td>HDG Offset</td>
                    <td><input type="number" step="0.1" value="0.0" id="hdg-offset"></td>
                </tr>
                <tr>
                    <td>Damping</td>
                    <td><input type="number" min="1" step="1" value="30" id="damping"></td>
                </tr>
            </table>
        </div>
    </div>
</div>
<hr/>
<div>
    <h4><button onclick="addChannel();">Add</button> Input Channels</h4>
    <div id="channel-list"></div>
</div>
<hr/>
<div>
    <h4><button onclick="addForwarder();">Add</button> Output Channels</h4>
    <div id="forwarder-list"></div>
</div>
<hr/>
<div>
    <h4><button onclick="addComputer();">Add</button> Computers</h4>
    <div id="computer-list"></div>
</div>
<hr/>
<div>
    <button onclick="generateTheCode();">Generate YAML</button>
</div>
<hr/>
<span style="font-style: italic;">Oliv Did it!</span>

</body>
</html>